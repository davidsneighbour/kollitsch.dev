---
import Heading from "@components/Heading.astro";
import GroupNav from "@components/releases/GroupNav.astro";
import ReleaseCard from "@components/releases/ReleaseCard.astro";
import setup from "@data/setup.json" with { type: "json" };
import Layout from "@layouts/DefaultPage.astro";
import type { Release } from "@utils/releases.ts";
import { getReleasesPerPage, loadAllReleases, paginate } from "@utils/releases.ts";

const all: Release[] = await loadAllReleases();
const perPage = getReleasesPerPage(100);
const slice = paginate(all, 1, perPage);

const post = {
  data: {
    description: setup.description,
    title: `Releases â€“ Page ${slice.page}/${slice.totalPages}`,
  },
};

const prevUrl = null;
const nextUrl = slice.page < slice.totalPages ? `/releases/${slice.page + 1}/` : null;
---

<Layout post={post}>
  <GroupNav all={all} currentGroup={null} />

  <Heading level={2}>Latest releases</Heading>

  <div class="flex flex-col gap-4">
    {slice.items.map((r) => <ReleaseCard release={r} />)}
  </div>

  <nav class="mt-6 flex justify-between">
    {prevUrl ? <a href={prevUrl}>Previous</a> : <span />}
    <span>Page {slice.page}of {slice.totalPages}</span>
    {nextUrl ? <a href={nextUrl}>Next</a> : <span />}
  </nav>

  <GroupNav all={all} currentGroup={null} />
</Layout>
