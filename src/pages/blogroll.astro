---
// layout: "@layouts/ContentPage.astro"
// title: /blogroll
// linktitle: blogroll
// description: A collection of blogs I follow.
// url: /blogroll
// date: 2024-09-28T15:06:05+07:00
// publishdate: 2024-09-28T15:06:05+07:00
// lastmod: 2024-09-28T15:06:05+07:00
// resources:
//   - title: Blogrolling.
//     src: mushaboom-studio-HNF0zZ7McOw-unsplash.jpg
// publisher: rework
// cover: ./mushaboom-studio-HNF0zZ7McOw-unsplash.jpg

// src/pages/blogroll.astro
// Astro 5+. Renders a formatted list from src/content/blogroll.json
// Validates with Zod (see zod-feed-validator.ts) and sorts by name ASC.
// Errors are shown on the page instead of crashing the build.

import IconLink from "@components/IconLink.astro";
import blogroll from "@content/blogroll.json" with { type: "json" };
import Layout from "@layouts/ContentPage.astro";

import { z } from "astro/zod";

type FeedItemSchema = z.ZodObject<{
  description: z.ZodOptional<z.ZodString>;
  name: z.ZodString;
  rss: z.ZodOptional<z.ZodString>;
  url: z.ZodString;
}>;

/**
 * Feed item type inferred from the schema.
 */
export type FeedItem = z.infer<FeedItemSchema>;

let items: FeedItem[] = blogroll.items;
---

<Layout>
  <ul>
    {
      items.map((item) => (
        <li>
          <a href={item.url} rel="noopener noreferrer" target="_blank">
            {item.name}
          </a>
          {item.rss && <IconLink icon="rss" href={item.rss} title={`RSS for ${item.name}`} />}
          {item.description && <div set:html={item.description} />}
        </li>
      ))
    }
  </ul>
</Layout>
