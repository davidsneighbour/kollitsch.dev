---
// for single post pages like /blog/yyyy/post-title/

// import type {
//   InferGetStaticParamsType,
// } from "astro";
//type Params = InferGetStaticParamsType<typeof getStaticPaths>;

import { getCollection } from "astro:content";
import BlogPost from "@components/BlogPost.astro";
// components
import Layout from "@layouts/DefaultPage.astro";

export const getStaticPaths = async () => {
  const allPosts = await getCollection("blog", ({ data }) => !data.draft);

  return allPosts
    .map((post) => {
      const parts = post.id.split("/");
      if (parts.length !== 2) {
        console.warn(`[blog] Skipping invalid slug: ${post.id}`);
        return null;
      }
      const [year, slug] = parts;
      return {
        params: { slug, year },
        props: { post },
      };
    })
    .filter(Boolean);
};

const { post } = Astro.props;

if (import.meta.env.PROD && post.data.draft) {
  throw new Error(
    `[blog] Tried to render draft post in production: ${post.id}`,
  );
}
---

<Layout
  post={post}
  title={post.data.title}
  description={post.data.description ?? ''}
>
  <BlogPost post={post} />
</Layout>
