---
// for /blog/1/, /blog/2/, /blog/3/ (pagination)

import type { InferGetStaticParamsType } from 'astro';

type Params = InferGetStaticParamsType<typeof getStaticPaths>;

import { getCollection } from 'astro:content';
import Layout from '@layouts/DefaultPage.astro';
import Heading from '@components/Heading.astro';
import Pagination from '@components/Pagination.astro';
import { getPostsSortedByDraft } from '@utils/getPostsSortedByDraft';
import ArticleCard from '@components/ArticleCard.astro';

export async function getStaticPaths() {
  const posts = getPostsSortedByDraft(await getCollection('blog'));
  const pageSize = 10;
  const totalPages = Math.ceil(posts.length / pageSize);

  return Array.from({ length: totalPages }).map((_, i) => ({
    params: { page: i === 0 ? '1' : `${i + 1}` }, // all as strings
  }));
}

const { page } = Astro.params as Params;
const pageNumber = Number(page) || 1; // default to 1 if not provided
const allPosts = getPostsSortedByDraft(await getCollection('blog'));
const posts = allPosts.slice((pageNumber - 1) * 10, pageNumber * 10);
const totalPages = Math.ceil(allPosts.length / 10);

const post = {
  data: {
    title: `Blog | Page ${pageNumber}`,
    description: 'A collection of articles, tutorials, and updates.',
  },
};
---

<Layout post={post}>
  <Heading
    title="Blog"
    description="A collection of articles, tutorials, and updates."
  />
  {
    posts.map(post => {
      return <ArticleCard post={post} />;
    })
  }
  <Pagination
    basePath="/blog"
    currentPage={pageNumber}
    totalPages={totalPages}
  />
</Layout>
