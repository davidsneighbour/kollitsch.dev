---
import type { CollectionEntry } from 'astro:content';
import type { ImageMetadata } from 'astro';

import { resolveCoverImage, resolveImagePath, resolveAstroImage } from '@utils/utilities';
import { Image } from 'astro:assets';

interface Props {
  post: CollectionEntry<'blog'>;
  classes?: string;
}
const { post, classes = 'w-full max-w-full h-auto mb-4' }: Props = Astro.props;

const coverImage = resolveCoverImage(post);
const imagePath = resolveImagePath(coverImage.src, post.id);
const imageMeta: ImageMetadata | null = imagePath ? resolveAstroImage(imagePath) : null;

---

{imageMeta && (

  <figure>
    <Image
      src={imageMeta}
      alt={coverImage.alt}
      width="1280"
      loading="lazy"
      class={classes}
      priority
    />
    {coverImage.title && (
      <figcaption set:html={coverImage.title} class="px-4"></figcaption>
    )}
  </figure>
)}
