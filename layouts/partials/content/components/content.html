{{- $type := .type | default "blog" -}}
{{- $post := .post -}}
{{- $artist := dict -}}

{{ if eq $type "music" }}
  {{- $artist = collections.First 1 (where
        site.Data.dnb.kollitsch.music
        "slug"
        $post.Params.video.artist
  ) -}}
  {{- $artist = (index $artist 0) -}}
{{ end }}

{{ if and (page.IsNode) (ne .is_preview false) }}

  {{- $output := "" -}}
  {{- with $post.Summary -}}
    {{- $output = . | transform.Markdownify -}}
  {{- else -}}
    {{- with $post.Description -}}
      {{- $output = . | transform.Markdownify -}}
    {{- else -}}
      {{- $output = $post.Content | transform.Markdownify | strings.Truncate 200 -}}
    {{- end -}}
  {{- end -}}

  <p class="text-truncate text-truncate-3">
  {{- if eq "" $output -}}
    {{- lang.Translate "theme.this_is" }} "{{- $post.Params.video.title -}}" {{ lang.Translate "theme.by" }}
    <a href="{{- $artist.link -}}">
      {{- $artist.name -}}
    </a>. {{ $artist.description | transform.Markdownify -}}
  {{ else }}
    {{- $output -}}
  {{- end -}}
  </p>

{{ else }}

  {{- with $post.Content -}}
    {{- . -}}
  {{- end -}}

  {{- if eq $type "music" -}}
    {{- $name := $artist.name -}}
    {{- with $post.Params.video.name -}}
      {{- $name = . -}}
    {{- end -}}
    <div class="alert alert-light" role="alert">
      <p>
        {{- lang.Translate "theme.this_is" }} "{{- $post.Params.video.title -}}" {{ lang.Translate "theme.by" }}
        <a href="{{- $artist.link -}}">
          {{- $artist.name -}}
        </a>.
      </p>
      <p>
        {{- $artist.description | transform.Markdownify -}}
      </p>
    </div>
  {{- end -}}
{{ end }}

