#!/bin/bash

REQUIRED_TOOLS=(
	curl
)

for TOOL in "${REQUIRED_TOOLS[@]}"; do
	if ! command -v "${TOOL}" >/dev/null; then
		echo "${TOOL} is required... "
		exit 1
	fi
done

FILE=.env
if [ -f "$FILE" ]; then
	echo "exporting .env"
	set -a # export all variables created next
	# shellcheck source=.env
	source "${FILE}"
	set +a # stop exporting
fi

# file location
COMPONENTPATH="./content/components"

AUTH="-u ${GITHUB_USERNAME}:${GITHUB_SECRET}"

# go through elements
for DIRNAME in "${COMPONENTPATH}"/*/; do
	DIR=$(basename "$DIRNAME")
	if [[ $DIR == 'references' ]]; then
		continue
	fi

	URL="https://api.github.com/repos/davidsneighbour/${DIR}/releases/latest"
	curl "${URL}" "${AUTH}" --output ./content/components/"${DIR}"/data.json

done
