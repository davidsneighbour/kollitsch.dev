---
// for single post pages like /blog/yyyy/post-title/

import type {
  InferGetStaticParamsType,
} from "astro";
type Params = InferGetStaticParamsType<typeof getStaticPaths>;

import { getCollection } from 'astro:content';

// components
import Layout from '@layouts/MarkdownPage.astro';
import BlogPost from '@components/BlogPost.astro';

export const getStaticPaths = (async () => {
  const allPosts = await getCollection('blog');
  return allPosts
    .map((post) => {
      const parts = post.slug.split('/');
      if (parts.length !== 2) {
        console.warn(`[blog] Skipping invalid slug: ${post.slug}`);
        return null;
      }
      const [year, slug] = parts;
      return {
        params: { year, slug },
        props: { post }
      };
    })
    .filter(Boolean);
});

const { year, slug } = Astro.params as Params;
const urlSlug = `${year}/${slug}`;
const { post } = Astro.props;

---

<Layout post={post} title={post.data.title} description={post.data.description ?? ''}>
  <BlogPost post={post} urlslug={urlSlug} />
</Layout>
