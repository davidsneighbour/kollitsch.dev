---
import { getCollection } from 'astro:content';
import Layout from '@layouts/DefaultPage.astro';
import BlogPost from '@components/BlogPost.astro';
import { Debug } from 'astro:components';

export async function getStaticPaths() {
  const entries = await getCollection('pages');

  return entries.map(post => {
    const slug = post.id
      .replace(/^pages\//, '')
      .replace(/\/index$/, '')
      .replace(/\.mdx?$/, '');

    console.log(post);
    console.log(slug);

    return {
      params: {
        page: slug, // always returns array
      },
      props: { post },
    };
  });
}

const { post } = Astro.props;

console.log(post);
console.log(process.env);

if (!post && import.meta.env.DEV) {
  throw new Error(`Page not found: ${Astro.params.page}`);
}
---

<Layout post={post}>
  <BlogPost post={post} />
  <Debug post={post} />
</Layout>
