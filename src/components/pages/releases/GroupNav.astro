---
import type { Release } from "@utils/releases.ts";
import { getMinorGroups } from "@utils/releases.ts";
import { Icon } from "astro-icon/components";

const { all, currentGroup: propGroup } = Astro.props as {
  all: Release[];
  currentGroup?: string | null;
};

const groups = getMinorGroups(all);
const currentGroup = propGroup ?? null;

const items = [
  {
    href: "/releases/",
    isCurrent: currentGroup === null,
    label: "Latest",
  },
  ...groups.map((group) => ({
    href: `/releases/${group}/`,
    isCurrent: currentGroup === group,
    label: group,
  })),
];
---

{
  groups.length === 0 ? null : (
    <div class="isolate flex justify-end mb-4">
      <label for="release-group" class="sr-only">
        Choose release group
      </label>
      <div class="mt-2 grid grid-cols-1">
        <select
          aria-label="Release group"
          onchange="if(this.value) window.location.href = this.value"
          class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white/5 py-1.5 pr-8 pl-3 text-base text-white outline-1 -outline-offset-1 outline-white/10 *:bg-gray-800 focus-visible:outline-2 focus-visible:-outline-offset-2 focus-visible:outline-indigo-500 sm:text-sm/6"
        >
          {items.map((item) => (
            <option value={item.href} selected={item.isCurrent}>
              {item.label}
            </option>
          ))}
        </select>
        <Icon
          class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-400 sm:size-4"
          name="chevron-compact-down"
        />
      </div>
    </div>
  )
}
