#!/bin/bash

REQUIRED_TOOLS=(
  cat
)

for TOOL in "${REQUIRED_TOOLS[@]}"; do
  if ! command -v "${TOOL}" >/dev/null; then
    echo "${TOOL} is required... "
    exit 1
  fi
done

get_latest_release() {
  curl --silent "https://api.github.com/repos/gohugoio/hugo/releases/latest" |
    grep '"tag_name":' |
    sed -E 's/.*"v([^"]+)".*/\1/'
}

cat <<EOF
[build]
publish = "./public"

[context.production]
command = "./bin/netlify/build"

[context.production.environment]
HUGO_VERSION = "$(get_latest_release)"
HUGO_ENV = "production"
GO_VERSION = "1.17"
NODE_ENV = "development"

[functions]
directory = "assets/functions"

[[plugins]]
package = "./bin/netlify/plugins/hugo-helper"

[plugins.inputs]
debug = false

# [[plugins]]
# package = "netlify-plugin-image-optim"

[[plugins]]
package = "@netlify/plugin-emails"
EOF
