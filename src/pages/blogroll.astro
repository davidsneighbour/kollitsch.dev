---
// layout: "@layouts/ContentPage.astro"
// title: /blogroll
// linktitle: blogroll
// description: A collection of blogs I follow.
// url: /blogroll
// date: 2024-09-28T15:06:05+07:00
// publishdate: 2024-09-28T15:06:05+07:00
// lastmod: 2024-09-28T15:06:05+07:00
// resources:
//   - title: Blogrolling.
//     src: mushaboom-studio-HNF0zZ7McOw-unsplash.jpg
// publisher: rework
// cover: ./mushaboom-studio-HNF0zZ7McOw-unsplash.jpg

// src/pages/blogroll.astro
// Astro 5+. Renders a formatted list from src/content/blogroll.json
// Validates with Zod (see zod-feed-validator.ts) and sorts by name ASC.
// Errors are shown on the page instead of crashing the build.

import type { FeedItem } from '@utils/blogroll';
import { safeValidateFeedList } from '@utils/blogroll';
import blogroll from '../content/blogroll.json';
import Layout from '@layouts/ContentPage.astro';
import IconLink from '@components/IconLink.astro';

// Validate and sort
let items: FeedItem[] = [];
let errors: string[] = [];

{
  const result = safeValidateFeedList(blogroll, {
    maxNameLength: 56,
    allowEmpty: true,
  });
  if (result.ok) {
    items = [...result.data].sort((a, b) => a.name.localeCompare(b.name));
  } else {
    errors = result.errors;
  }
}
---

<Layout>
  {
    errors.length > 0 ? (
      <section aria-labelledby="validation-errors">
        <h2 id="validation-errors">Validation errors</h2>
        <ul>
          {errors.map(e => (
            <li>{e}</li>
          ))}
        </ul>
      </section>
    ) : (
      <ul>
        {items.map(item => (
          <li>
            <a
              href={item.url}
              rel="noopener noreferrer"
              target="_blank"
            >
              {item.name}
            </a>
            {item.rss && (
              <IconLink
                icon="rss"
                href={item.rss}
                title={`RSS for ${item.name}`}
              />
            )}
            {item.description && <div set:html={item.description} />}
          </li>
        ))}
      </ul>
    )
  }
</Layout>
